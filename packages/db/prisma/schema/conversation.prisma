model Conversation {
  id              String   @id @default(uuid())
  tenantId        String
  channel         String
  instanceId      String
  contactId       String
  status          String
  isActive        Boolean  @default(true)
  assignedAgentId String?
  openedAt        DateTime
  lastMessageAt   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  messages Message[]

  @@index([tenantId, instanceId, contactId])
  @@unique([instanceId, contactId, isActive])
  @@map("conversation")
}

model Message {
  id                String   @id @default(uuid())
  conversationId    String
  direction         String
  type              String
  sentBy            String
  providerMessageId String?
  contentRef        String?
  metadata          Json?
  occurredAt        DateTime

  createdAt DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId, occurredAt])
  @@unique([conversationId, providerMessageId])
  @@map("message")
}

