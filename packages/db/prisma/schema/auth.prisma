// =============================================================================
// AUTH MODELS - Better Auth with Admin & Organization Plugins
// =============================================================================

model User {
	id            String    @id
	name          String
	email         String
	emailVerified Boolean   @default(false)
	image         String?
	createdAt     DateTime  @default(now())
	updatedAt     DateTime  @updatedAt

	// === ADMIN PLUGIN FIELDS ===
	role       String    @default("user") // "user" | "admin"
	banned     Boolean   @default(false)
	banReason  String?
	banExpires DateTime?

	// === RELATIONS ===
	sessions    Session[]
	accounts    Account[]
	members     Member[] // Memberships in organizations
	invitations Invitation[] // Invitations sent by this user

	@@unique([email])
	@@index([role])
	@@index([banned])
	@@map("user")
}

model Session {
	id        String   @id
	expiresAt DateTime
	token     String
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt
	ipAddress String?
	userAgent String?
	userId    String
	user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

	// === ORGANIZATION PLUGIN FIELDS ===
	activeOrganizationId String?

	@@unique([token])
	@@index([userId])
	@@map("session")
}

model Account {
	id                    String    @id
	accountId             String
	providerId            String
	userId                String
	user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
	accessToken           String?
	refreshToken          String?
	idToken               String?
	accessTokenExpiresAt  DateTime?
	refreshTokenExpiresAt DateTime?
	scope                 String?
	password              String?
	createdAt             DateTime  @default(now())
	updatedAt             DateTime  @updatedAt

	@@index([userId])
	@@map("account")
}

model Verification {
	id         String   @id
	identifier String
	value      String
	expiresAt  DateTime
	createdAt  DateTime @default(now())
	updatedAt  DateTime @updatedAt

	@@index([identifier])
	@@map("verification")
}

// =============================================================================
// ORGANIZATION PLUGIN MODELS
// =============================================================================

model Organization {
	id        String   @id
	name      String
	slug      String   @unique
	logo      String?
	metadata  String? // JSON string for additional data
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt

	// === RELATIONS ===
	members     Member[]
	invitations Invitation[]
	teams       Team[]

	@@index([slug])
	@@map("organization")
}

model Member {
	id             String   @id
	organizationId String
	userId         String
	role           String   @default("member") // "owner" | "admin" | "member"
	createdAt      DateTime @default(now())
	updatedAt      DateTime @updatedAt

	// === RELATIONS ===
	organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
	user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
	teamMembers  TeamMember[]

	@@unique([organizationId, userId])
	@@index([organizationId])
	@@index([userId])
	@@map("member")
}

model Invitation {
	id             String   @id
	organizationId String
	email          String
	role           String   @default("member") // "admin" | "member"
	status         String   @default("pending") // "pending" | "accepted" | "rejected" | "canceled"
	expiresAt      DateTime
	inviterId      String
	createdAt      DateTime @default(now())
	updatedAt      DateTime @updatedAt

	// === RELATIONS ===
	organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
	inviter      User         @relation(fields: [inviterId], references: [id], onDelete: Cascade)

	@@index([organizationId])
	@@index([email])
	@@index([status])
	@@map("invitation")
}

// =============================================================================
// TEAM MODELS (Organization Teams Plugin)
// =============================================================================

model Team {
	id             String   @id
	name           String
	organizationId String
	createdAt      DateTime @default(now())
	updatedAt      DateTime @updatedAt

	// === RELATIONS ===
	organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
	members      TeamMember[]

	@@unique([organizationId, name])
	@@index([organizationId])
	@@map("team")
}

model TeamMember {
	id        String   @id
	teamId    String
	memberId  String
	createdAt DateTime @default(now())

	// === RELATIONS ===
	team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)
	member Member @relation(fields: [memberId], references: [id], onDelete: Cascade)

	@@unique([teamId, memberId])
	@@index([teamId])
	@@index([memberId])
	@@map("team_member")
}
